<!--
`clearable-input` is a Polymer element that encapsulates the idea of a text input that has a clickable icon inside the element to clear the input.

<clearable-input></clearable-input>

@author Brent Hosie
@element clearable-input
@homepage http://github.com/xrapiddavex/clearable-input/
-->

<link rel="import" href="../polymer/polymer.html"/>

<polymer-element name="clearable-input" attributes="placeholder value readonly disabled backgroundColor color">
	<template>
		<style>
			span.wrapper {
                position: relative;
            }
            span.wrapper span {
                position: absolute;
                display: block;
                right: 5px;
                top: 0px;                
                cursor: pointer;
                opacity: 0;
            }
		</style>
		<span class="wrapper">
            <input type="text" id="textInput" placeholder="{{placeholder}}" value="{{value}}" on-click="{{fireClicked}}" on-change="{{valueChanged}}" on-keydown="{{valueChanged}}" on-cut="{{valueChanged}}" on-paste="{{valueChanged}}"/>
            <span id="clearInput" on-click="{{testClearInput}}" style="color:{{color}};">&#10005;</span>
        </span>
	</template>
	<script>
		(function() {
			"use strict";			

			var determineButtonState = function() {
				// when length 0, opacity is 0
				this.$.clearInput.style.opacity = (this.$.textInput.value.length !== 0 && this.disabled === void 0 ? 1 : 0);
				
				if(this.disabled === void 0) {
					this.$.clearInput.style.cursor = 'pointer';
				} else {
					this.$.clearInput.style.cursor = 'default';
				}
			};

			Polymer({
				/**
	            * The placeholder of the text input
	            *
	            * @attribute placeholder
	            * @access public
	            * @type string
	            * @default ''
	            */
				placeholder: '',
				/**
	            * The value of the text input
	            *
	            * @attribute value
	            * @access public
	            * @type string
	            * @default ''
	            */
				value: '',
				/**
	            * The background color of the text input. This field supports
	            * hexidecimal and standard html colors.
	            *
	            * @attribute backgroundColor
	            * @access public
	            * @type string
	            * @default '#FFF'
	            */
				backgroundColor: '#FFF',
				/**
	            * The color of the text input's text, and text input's clear button.
	            * This field supports hexidecimal and standard html colors.
	            *
	            * @attribute color
	            * @access public
	            * @type string
	            * @default '#000'
	            */
				color: '#000',

				/**
				* On Polymer ready, set defaults
				*/
				ready: function() {
					/**
		            * If set on the element, makes the text input readonly. The text input is still clearable.
		            *
		            * @attribute readonly
		            * @access public
		            * @type boolean
		            * @default undefined
		            */
					this.$.textInput.readOnly = (this.readonly !== void 0);
					/**
		            * If set on the element, makes the text input disabled. The text input will not be clearable.
		            * Disabled overrides readonly.
		            *
		            * @attribute disabled
		            * @access public
		            * @type boolean
		            * @default undefined
		            */
					this.$.textInput.disabled = (this.disabled !== void 0);
				},

				/**
				* Tests whether or not clicking on the clear button should clear the value.
				* Returns true if the disabled attribute is not set, false otherwise.
				*
				* function testClearInput
				* access public
				* returns boolean
				*/
				testClearInput: function() {
					if(this.disabled === void 0) {
						this.clearInput();
						return true;
					}

					return false;
				},

				/**
				* Programmatically clears the value of the text input
				*
				* @method clearInput
				* @access public
				* @returns boolean
				*/
				clearInput: function() {
					this.value='';
					/**
                    * Fires when the the value of the text input is cleared
                    *
                    * @event clear
                    */
					this.fire('clear');
					return true;
				},

				/**
				* Is called when the value of the text input changes
				*
				* @method valueChanged
				* @access public
				* @returns undefined
				*/
				valueChanged: function() {
					// need this to deal with programmatic setting.
					setTimeout(function() {
						determineButtonState.call(this);
						/**
	                    * Fires when the the value of the text input is changed
	                    *
	                    * @event change
	                    */
						this.fire('change');
					}.bind(this), 0);
				},

				/**
				* Is called when the text input is clicked on. This will allow people to tell when the input itself is clicked,
				* not when the clearable button is clicked
				*
				* method valueChanged
				* access public
				* returns undefined
				*/
				fireClicked: function() {
					/**
                    * Fires only when the input itself is clicked, not when the clearable button is clicked
                    *
                    * @event inputClicked
                    */
					this.fire('inputClicked')
				}
			});
		})();
	</script>
</polymer-element>