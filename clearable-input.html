<!--
`clearable-input` is a Polymer element that encapsulates the idea of a text input that has a clickable icon inside the element to clear the input.

<clearable-input></clearable-input>

@author Brent Hosie
@element clearable-input
@homepage http://github.com/xrapiddavex/clearable-input/
-->

<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../core-icons/core-icons.html">

<polymer-element name="clearable-input" attributes="placeholder value readonly isdisabled backgroundColor color icon">
	<template>
		<style>
			span.wrapper {
                position: relative;
            }
            #iconWrapper {
                position: absolute;
                display: block;
                right: 5px;
                top: 0px;                
                cursor: pointer;
                width: 12px;
                height: 12px;
            }
            #iconWrapper core-icon {
            	width: 12px;
            	height: 12px;
            }
		</style>
		<span class="wrapper">
            <input type="text" id="textInput" placeholder="{{placeholder}}" value="{{value}}" on-click="{{fireClicked}}" on-change="{{valueChanged}}" on-keydown="{{valueChanged}}" on-cut="{{valueChanged}}" on-paste="{{valueChanged}}"/>
            <div id="iconWrapper">
            	<core-icon id="clearInput" icon="{{icon}}" on-click="{{testClearInput}}" hidden?="{{clearHidden}}"></core-icon>
            </div>
        </span>
	</template>
	<script>
		(function() {
			"use strict";

			Polymer({
				/**
	            * The placeholder of the text input
	            *
	            * @attribute placeholder
	            * @access public
	            * @type string
	            * @default ''
	            */
				placeholder: '',
				/**
	            * The value of the text input
	            *
	            * @attribute value
	            * @access public
	            * @type string
	            * @default ''
	            */
				value: '',
				/**
	            * The background color of the text input. This field supports
	            * hexidecimal and standard html colors.
	            *
	            * @attribute backgroundColor
	            * @access public
	            * @type string
	            * @default '#FFF'
	            */
				backgroundColor: '#FFF',
				/**
	            * The color of the text input's text, and text input's clear button.
	            * This field supports hexidecimal and standard html colors.
	            *
	            * @attribute color
	            * @access public
	            * @type string
	            * @default '#000'
	            */
				color: '#000',
				/**
	            * Whether or not to show the clear input
	            *
	            * attribute clearHidden
	            * access public
	            * type boolean
	            * default true
	            */
				clearHidden: true,

				/**
				* On Polymer ready, set defaults
				*/
				ready: function() {
					/**
		            * If set on the element, makes the text input readonly. The text input is still clearable.
		            *
		            * @attribute readonly
		            * @access public
		            * @type boolean
		            * @default undefined
		            */
					this.$.textInput.readOnly = (this.readonly !== void 0);
					/**
		            * If set on the element, makes the text input disabled. The text input will not be clearable.
		            * isDisabled overrides readonly.
		            *
		            * @attribute isDisabled
		            * @access public
		            * @type boolean
		            * @default undefined
		            */
					this.$.textInput.disabled = (this.isdisabled !== void 0);
					/**
		            * The core-icon that's used for clearing the input text
		            *
		            * @attribute icon
		            * @access public
		            * @type string
		            * @default 'clear'
		            */
					if(typeof this.icon !== 'string' || this.icon.length === 0) {
						this.icon = "clear";
					}

					setInterval(function() {
						this.clearHidden = this.$.textInput.value.length === 0 || this.isdisabled !== void 0;
					}.bind(this), 100);


				},

				/**
				* Tests whether or not clicking on the clear button should clear the value.
				* Returns true if the isDisabled attribute is not set, false otherwise.
				*
				* function testClearInput
				* access public
				* returns boolean
				*/
				testClearInput: function() {
					if(this.isdisabled === void 0) {
						this.clearInput();
						return true;
					}

					return false;
				},

				/**
				* Programmatically clears the value of the text input
				*
				* @method clearInput
				* @access public
				* @returns boolean
				*/
				clearInput: function() {
					this.value='';
					/**
                    * Fires when the the value of the text input is cleared
                    *
                    * @event clear
                    */
					this.fire('clear');
					return true;
				},

				/**
				* Is called when the value of the text input changes
				*
				* @method valueChanged
				* @access public
				* @returns undefined
				*/
				valueChanged: function() {
					/**
                    * Fires when the the value of the text input is changed
                    *
                    * @event change
                    */
					this.fire('change');
				},

				/**
				* Is called when the text input is clicked on. This will allow people to tell when the input itself is clicked,
				* not when the clearable button is clicked
				*
				* method valueChanged
				* access public
				* returns undefined
				*/
				fireClicked: function() {
					/**
                    * Fires only when the input itself is clicked, not when the clearable button is clicked
                    *
                    * @event inputclicked
                    */
					this.fire('inputclicked')
				}
			});
		})();
	</script>
</polymer-element>
