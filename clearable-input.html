<!--
`clearable-input` is a Polymer element that encapsulates the idea of a text input that has a clickable icon inside the element to clear the input.

<clearable-input></clearable-input>

@author Brent Hosie
@author Garrett Nay
@element clearable-input
@homepage http://github.com/xrapiddavex/clearable-input/
-->

<link rel="import" href="../polymer/polymer.html"/>

<polymer-element name="clearable-input" attributes="placeholder value readonly disabled backgroundColor color">
	<template>
		<style>
			span.wrapper {
                position: relative;
            }
            span.wrapper span {
                position: absolute;
                display: block;
                right: 5px;
                top: 0px;                
                cursor: pointer;
                opacity: 0;
            }
		</style>
		<span class="wrapper">
            <input type="text" id="textInput" placeholder="{{placeholder}}" style="background-color:{{backgroundColor}};color:{{color}};" value="{{value}}" on-change="{{valueChanged}}" on-keydown="{{valueChanged}}" on-cut="{{valueChanged}}" on-paste="{{valueChanged}}"/>
            <span id="clearInput" on-click="{{testClearInput}}">&#10005;</span>
        </span>
	</template>
	<script>
		(function() {
			"use strict";			

			var determineButtonState = function() {
				// when length 0, opacity is 0
				this.$.clearInput.style.opacity = (this.$.textInput.value.length !== 0 && this.disabled === void 0 ? 1 : 0);
				
				if(this.disabled === void 0) {
					this.$.clearInput.style.cursor = 'pointer';
				} else {
					this.$.clearInput.style.cursor = 'default';
				}
			};

			Polymer({
				value: '',
				backgroundColor: '#FFF',
				color: '#000',

				ready: function() {
					this.$.textInput.readOnly = (this.readonly !== void 0);
					this.$.textInput.disabled = (this.disabled !== void 0);
					this.$.textInput.style.backgroundColor = this.readonlyBGColor;
				},

				testClearInput: function() {
					if(this.disabled === void 0) {
						this.clearInput();
						return true;
					}

					return false;
				},

				clearInput: function() {
					this.value='';
					return true;
				},

				valueChanged: function() {
					// need this to deal with programmatic setting.
					setTimeout(function() {
						determineButtonState.call(this);
					}.bind(this), 0);
				}
			});
		})();
	</script>
</polymer-element>